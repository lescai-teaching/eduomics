nextflow_process {

    name "Test Process DEANALYSIS"
    script "../main.nf"
    process "DEANALYSIS"

    tag "modules"
    tag "modules_"
    tag "deanalysis"

    test("deanalysis - run") {

        when {
            process {
                """
                input[0] = [
                    [ id:'test', reps:3, groups:2 ], // meta map
                    file('/workspaces/eduomics/modules/local/deanalysis/tests', checkIfExists: true)
                ]
                input[1] = file("https://raw.githubusercontent.com/lescai-teaching/eduomics_testdata/refs/heads/main/rnaseq/countmatrices/gff3_chr22.rds", checkIfExists: true)
                """
            }
        }

        then {
                assert process.success
                assert process.out.ma_plot
                assert process.out.dispersion_plot
                assert process.out.count_plot
                assert process.out.results
                assert process.out.heatmap_plot
                assert process.out.pca_plot
                assert process.out.versions
        }
    }

    test("deanalysis - stub") {

        options "-stub"

        when {
            process {
                """
                input[0] = [
                    [ id:'test', reps:3, groups:2 ], // meta map
                    file('/workspaces/eduomics/modules/local/deanalysis/tests', checkIfExists: true)
                ]
                input[1] = file("https://raw.githubusercontent.com/lescai-teaching/eduomics_testdata/refs/heads/main/rnaseq/countmatrices/gff3_chr22.rds", checkIfExists: true)
                """
            }
        }

        then {
            assert process.success
                assert process.out.ma_plot
                assert process.out.dispersion_plot
                assert process.out.count_plot
                assert process.out.results
                assert process.out.heatmap_plot
                assert process.out.pca_plot
                assert process.out.versions
        }
    }
}
